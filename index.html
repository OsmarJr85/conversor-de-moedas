<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor de Moedas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .converter-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            align-items: end;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .currency-input, .currency-select {
            flex: 1;
            min-width: 150px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .swap-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 8px;
        }

        .swap-btn:hover {
            background: #5a6fd8;
            transform: rotate(180deg);
        }

        .result-section {
            text-align: center;
        }

        .result {
            margin-bottom: 20px;
        }

        #convertedAmount {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            display: block;
        }

        .exchange-rate {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .convert-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .convert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .feature-card h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .rates-grid {
            display: grid;
            gap: 10px;
        }

        .rate-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        .clear-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .search-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .search-container h3 {
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-results {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .search-result-item {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .search-result-item:hover {
            background: #e9ecef;
        }

        footer {
            text-align: center;
            color: white;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .swap-btn {
                align-self: center;
                margin: 10px 0;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .error {
            color: #dc3545;
            text-align: center;
            margin-top: 10px;
        }

        .api-status {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 0.9rem;
            display: none;
        }

        .api-status.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üí∞ Conversor de Moedas</h1>
            <p>Convers√£o em tempo real para todas as moedas fiduci√°rias</p>
        </header>

        <main>
            <div id="apiStatus" class="api-status">
                Conectando √† API de c√¢mbio...
            </div>

            <div class="converter-card">
                <div class="input-group">
                    <div class="currency-input">
                        <label for="amount">Valor</label>
                        <input type="number" id="amount" value="1" min="0" step="0.01">
                    </div>
                    
                    <div class="currency-select">
                        <label for="fromCurrency">De</label>
                        <select id="fromCurrency"></select>
                    </div>
                    
                    <button id="swapButton" class="swap-btn">‚áÑ</button>
                    
                    <div class="currency-select">
                        <label for="toCurrency">Para</label>
                        <select id="toCurrency"></select>
                    </div>
                </div>

                <!-- Buscar Moeda reposicionada para abaixo dos campos de entrada -->
                <div class="search-container">
                    <h3>üîç Buscar Moeda</h3>
                    <input type="text" id="searchCurrency" placeholder="Digite o nome ou c√≥digo da moeda..." style="margin-bottom: 10px;">
                    <div id="searchResults" class="search-results"></div>
                </div>

                <div class="result-section">
                    <div id="result" class="result">
                        <span id="convertedAmount">-</span>
                        <span id="exchangeRate" class="exchange-rate"></span>
                    </div>
                    <button id="convertButton" class="convert-btn">Converter</button>
                </div>
            </div>

            <div class="features">
                <div class="feature-card">
                    <h3>üìà Taxas de C√¢mbio Populares</h3>
                    <div id="popularRates" class="rates-grid"></div>
                </div>

                <div class="feature-card">
                    <h3>üìä Hist√≥rico de Convers√µes</h3>
                    <div id="conversionHistory" class="history-list"></div>
                    <button id="clearHistory" class="clear-btn">Limpar Hist√≥rico</button>
                </div>
            </div>
        </main>

        <footer>
            <p>Taxas de c√¢mbio atualizadas em tempo real via ExchangeRate-API</p>
            <p id="lastUpdate"></p>
        </footer>
    </div>

    <script>
        class CurrencyConverter {
            constructor() {
                this.apiKey = 'b0b2d201b8b21be44f07a67a';
                this.baseURL = 'https://v6.exchangerate-api.com/v6';
                this.currencies = [];
                this.conversionHistory = JSON.parse(localStorage.getItem('conversionHistory')) || [];
                this.apiStatusElement = document.getElementById('apiStatus');
                
                this.initializeElements();
                this.testAPI();
                this.loadCurrencies();
                this.setupEventListeners();
            }

            async testAPI() {
                try {
                    const response = await fetch(`${this.baseURL}/${this.apiKey}/latest/USD`);
                    
                    if (!response.ok) {
                        throw new Error(`Erro HTTP: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.result === 'success') {
                        // Conex√£o bem-sucedida - n√£o mostrar mensagem
                        this.apiStatusElement.style.display = 'none';
                        this.loadPopularRates();
                        this.convertCurrency(); // Fazer uma convers√£o inicial
                    } else {
                        throw new Error(data['error-type'] || 'Erro na API');
                    }
                } catch (error) {
                    console.error('Erro ao testar API:', error);
                    this.updateAPIStatus('‚ùå Erro na conex√£o com a API: ' + error.message, 'error');
                }
            }

            updateAPIStatus(message, type) {
                this.apiStatusElement.textContent = message;
                this.apiStatusElement.className = 'api-status';
                if (type === 'error') {
                    this.apiStatusElement.classList.add('error');
                    this.apiStatusElement.style.display = 'block';
                }
            }

            initializeElements() {
                this.elements = {
                    amount: document.getElementById('amount'),
                    fromCurrency: document.getElementById('fromCurrency'),
                    toCurrency: document.getElementById('toCurrency'),
                    convertButton: document.getElementById('convertButton'),
                    swapButton: document.getElementById('swapButton'),
                    result: document.getElementById('result'),
                    convertedAmount: document.getElementById('convertedAmount'),
                    exchangeRate: document.getElementById('exchangeRate'),
                    popularRates: document.getElementById('popularRates'),
                    conversionHistory: document.getElementById('conversionHistory'),
                    clearHistory: document.getElementById('clearHistory'),
                    searchCurrency: document.getElementById('searchCurrency'),
                    searchResults: document.getElementById('searchResults'),
                    lastUpdate: document.getElementById('lastUpdate')
                };
            }

            loadCurrencies() {
                // Lista completa de moedas internacionais
                this.currencies = [
                    { code: 'USD', name: 'D√≥lar Americano', symbol: '$' },
                    { code: 'EUR', name: 'Euro', symbol: '‚Ç¨' },
                    { code: 'BRL', name: 'Real Brasileiro', symbol: 'R$' },
                    { code: 'GBP', name: 'Libra Esterlina', symbol: '¬£' },
                    { code: 'JPY', name: 'Iene Japon√™s', symbol: '¬•' },
                    { code: 'CAD', name: 'D√≥lar Canadense', symbol: 'C$' },
                    { code: 'AUD', name: 'D√≥lar Australiano', symbol: 'A$' },
                    { code: 'CHF', name: 'Franco Su√≠√ßo', symbol: 'CHF' },
                    { code: 'CNY', name: 'Yuan Chin√™s', symbol: '¬•' },
                    { code: 'INR', name: 'R√∫pia Indiana', symbol: '‚Çπ' },
                    { code: 'MXN', name: 'Peso Mexicano', symbol: '$' },
                    { code: 'ARS', name: 'Peso Argentino', symbol: '$' },
                    { code: 'CLP', name: 'Peso Chileno', symbol: '$' },
                    { code: 'COP', name: 'Peso Colombiano', symbol: '$' },
                    { code: 'PEN', name: 'Sol Peruano', symbol: 'S/' },
                    { code: 'UYU', name: 'Peso Uruguaio', symbol: '$' },
                    { code: 'RUB', name: 'Rublo Russo', symbol: '‚ÇΩ' },
                    { code: 'TRY', name: 'Lira Turca', symbol: '‚Ç∫' },
                    { code: 'KRW', name: 'Won Sul-Coreano', symbol: '‚Ç©' },
                    { code: 'SGD', name: 'D√≥lar de Singapura', symbol: 'S$' },
                    { code: 'NZD', name: 'D√≥lar Neozeland√™s', symbol: 'NZ$' },
                    { code: 'SEK', name: 'Coroa Sueca', symbol: 'kr' },
                    { code: 'NOK', name: 'Coroa Norueguesa', symbol: 'kr' },
                    { code: 'DKK', name: 'Coroa Dinamarquesa', symbol: 'kr' },
                    { code: 'ZAR', name: 'Rand Sul-Africano', symbol: 'R' },
                    { code: 'HKD', name: 'D√≥lar de Hong Kong', symbol: 'HK$' },
                    { code: 'TWD', name: 'D√≥lar Taiwan√™s', symbol: 'NT$' },
                    { code: 'THB', name: 'Baht Tailand√™s', symbol: '‡∏ø' },
                    { code: 'MYR', name: 'Ringgit Malaio', symbol: 'RM' },
                    { code: 'IDR', name: 'Rupia Indon√©sia', symbol: 'Rp' },
                    { code: 'PHP', name: 'Peso Filipino', symbol: '‚Ç±' },
                    { code: 'VND', name: 'Dong Vietnamita', symbol: '‚Ç´' },
                    { code: 'AED', name: 'Dirham dos Emirados', symbol: 'ÿØ.ÿ•' },
                    { code: 'SAR', name: 'Riyal Saudita', symbol: 'Ô∑º' },
                    { code: 'QAR', name: 'Rial Catarense', symbol: 'Ô∑º' },
                    { code: 'KWD', name: 'Dinar Kuwaitiano', symbol: 'ÿØ.ŸÉ' },
                    { code: 'EGP', name: 'Libra Eg√≠pcia', symbol: '¬£' },
                    { code: 'NGN', name: 'Naira Nigeriana', symbol: '‚Ç¶' },
                    { code: 'PLN', name: 'Zloty Polon√™s', symbol: 'z≈Ç' },
                    { code: 'CZK', name: 'Coroa Tcheca', symbol: 'Kƒç' },
                    { code: 'HUF', name: 'Forint H√∫ngaro', symbol: 'Ft' },
                    { code: 'RON', name: 'Leu Romeno', symbol: 'lei' },
                    { code: 'BGN', name: 'Lev B√∫lgaro', symbol: '–ª–≤' },
                    { code: 'HRK', name: 'Kuna Croata', symbol: 'kn' },
                    { code: 'ISK', name: 'Coroa Islandesa', symbol: 'kr' },
                    { code: 'UAH', name: 'Hryvnia Ucraniana', symbol: '‚Ç¥' },
                    { code: 'ILS', name: 'Novo Shekel Israelense', symbol: '‚Ç™' }
                ];

                this.populateCurrencySelects();
                this.setDefaultCurrencies();
            }

            populateCurrencySelects() {
                const fromSelect = this.elements.fromCurrency;
                const toSelect = this.elements.toCurrency;

                fromSelect.innerHTML = '';
                toSelect.innerHTML = '';

                this.currencies.forEach(currency => {
                    const optionFrom = new Option(`${currency.code} - ${currency.name}`, currency.code);
                    const optionTo = new Option(`${currency.code} - ${currency.name}`, currency.code);
                    
                    fromSelect.add(optionFrom);
                    toSelect.add(optionTo);
                });
            }

            setDefaultCurrencies() {
                this.elements.fromCurrency.value = 'USD';
                this.elements.toCurrency.value = 'BRL';
            }

            setupEventListeners() {
                this.elements.convertButton.addEventListener('click', () => this.convertCurrency());
                this.elements.swapButton.addEventListener('click', () => this.swapCurrencies());
                this.elements.clearHistory.addEventListener('click', () => this.clearHistory());
                this.elements.searchCurrency.addEventListener('input', () => this.searchCurrency());
                
                // Converter ao pressionar Enter
                this.elements.amount.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.convertCurrency();
                    }
                });

                // Converter automaticamente quando mudar as moedas
                this.elements.fromCurrency.addEventListener('change', () => this.convertCurrency());
                this.elements.toCurrency.addEventListener('change', () => this.convertCurrency());
            }

            async convertCurrency() {
                const amount = parseFloat(this.elements.amount.value);
                const fromCurrency = this.elements.fromCurrency.value;
                const toCurrency = this.elements.toCurrency.value;

                if (!amount || amount <= 0) {
                    this.showError('Por favor, insira um valor v√°lido.');
                    return;
                }

                this.setLoading(true);

                try {
                    const response = await fetch(`${this.baseURL}/${this.apiKey}/pair/${fromCurrency}/${toCurrency}/${amount}`);
                    
                    if (!response.ok) {
                        throw new Error(`Erro HTTP: ${response.status}`);
                    }
                    
                    const data = await response.json();

                    if (data.result !== 'success') {
                        throw new Error(data['error-type'] || 'Erro na convers√£o');
                    }

                    const convertedValue = data.conversion_result;
                    const rate = data.conversion_rate;

                    this.displayResult(amount, fromCurrency, toCurrency, convertedValue, rate);
                    this.addToHistory(amount, fromCurrency, toCurrency, convertedValue, rate);
                    
                    // Atualizar data da √∫ltima atualiza√ß√£o
                    this.elements.lastUpdate.textContent = `√öltima atualiza√ß√£o: ${new Date().toLocaleString()}`;

                } catch (error) {
                    console.error('Erro na convers√£o:', error);
                    this.showError('Erro ao obter taxa de c√¢mbio: ' + error.message);
                } finally {
                    this.setLoading(false);
                }
            }

            displayResult(amount, fromCurrency, toCurrency, convertedValue, rate) {
                const fromCurrencyObj = this.currencies.find(c => c.code === fromCurrency);
                const toCurrencyObj = this.currencies.find(c => c.code === toCurrency);

                const fromSymbol = fromCurrencyObj ? fromCurrencyObj.symbol : fromCurrency;
                const toSymbol = toCurrencyObj ? toCurrencyObj.symbol : toCurrency;

                this.elements.convertedAmount.textContent = 
                    `${toSymbol} ${convertedValue.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                
                this.elements.exchangeRate.textContent = 
                    `1 ${fromCurrency} = ${rate.toLocaleString('pt-BR', { minimumFractionDigits: 4, maximumFractionDigits: 4 })} ${toCurrency}`;
            }

            addToHistory(amount, fromCurrency, toCurrency, convertedValue, rate) {
                const historyItem = {
                    timestamp: new Date().toISOString(),
                    amount,
                    fromCurrency,
                    toCurrency,
                    convertedValue,
                    rate
                };

                this.conversionHistory.unshift(historyItem);
                
                // Manter apenas os √∫ltimos 10 itens
                if (this.conversionHistory.length > 10) {
                    this.conversionHistory = this.conversionHistory.slice(0, 10);
                }

                this.saveHistory();
                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                const historyContainer = this.elements.conversionHistory;
                historyContainer.innerHTML = '';

                if (this.conversionHistory.length === 0) {
                    historyContainer.innerHTML = '<p style="text-align: center; color: #666;">Nenhuma convers√£o realizada</p>';
                    return;
                }

                this.conversionHistory.forEach(item => {
                    const historyElement = document.createElement('div');
                    historyElement.className = 'history-item';
                    
                    const date = new Date(item.timestamp).toLocaleTimeString();
                    historyElement.innerHTML = `
                        <span>${item.amount} ${item.fromCurrency} ‚Üí ${item.convertedValue.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ${item.toCurrency}</span>
                        <span style="font-size: 0.8rem; color: #666;">${date}</span>
                    `;
                    
                    historyContainer.appendChild(historyElement);
                });
            }

            saveHistory() {
                localStorage.setItem('conversionHistory', JSON.stringify(this.conversionHistory));
            }

            clearHistory() {
                this.conversionHistory = [];
                this.saveHistory();
                this.updateHistoryDisplay();
            }

            swapCurrencies() {
                const fromValue = this.elements.fromCurrency.value;
                const toValue = this.elements.toCurrency.value;
                
                this.elements.fromCurrency.value = toValue;
                this.elements.toCurrency.value = fromValue;
                
                this.convertCurrency();
            }

            async loadPopularRates() {
                const baseCurrency = this.elements.fromCurrency.value;
                const popularPairs = ['USD', 'EUR', 'GBP', 'JPY', 'CAD'];
                
                try {
                    const response = await fetch(`${this.baseURL}/${this.apiKey}/latest/${baseCurrency}`);
                    
                    if (!response.ok) {
                        throw new Error(`Erro HTTP: ${response.status}`);
                    }
                    
                    const data = await response.json();

                    if (data.result !== 'success') {
                        throw new Error(data['error-type'] || 'Erro ao carregar taxas');
                    }
                    
                    this.elements.popularRates.innerHTML = '';
                    
                    popularPairs.forEach(currency => {
                        if (currency !== baseCurrency && data.conversion_rates[currency]) {
                            const rate = data.conversion_rates[currency];
                            const rateElement = document.createElement('div');
                            rateElement.className = 'rate-item';
                            rateElement.innerHTML = `
                                <span>1 ${baseCurrency}</span>
                                <span>= ${rate.toLocaleString('pt-BR', { minimumFractionDigits: 4, maximumFractionDigits: 4 })} ${currency}</span>
                            `;
                            this.elements.popularRates.appendChild(rateElement);
                        }
                    });
                } catch (error) {
                    console.error('Erro ao carregar taxas populares:', error);
                    this.elements.popularRates.innerHTML = '<p class="error">Erro ao carregar taxas</p>';
                }
            }

            searchCurrency() {
                const searchTerm = this.elements.searchCurrency.value.toLowerCase();
                const resultsContainer = this.elements.searchResults;
                
                resultsContainer.innerHTML = '';

                if (searchTerm.length < 2) {
                    return;
                }

                const filteredCurrencies = this.currencies.filter(currency => 
                    currency.code.toLowerCase().includes(searchTerm) ||
                    currency.name.toLowerCase().includes(searchTerm)
                );

                filteredCurrencies.forEach(currency => {
                    const resultElement = document.createElement('div');
                    resultElement.className = 'search-result-item';
                    resultElement.textContent = `${currency.code} - ${currency.name}`;
                    resultElement.addEventListener('click', () => {
                        this.elements.fromCurrency.value = currency.code;
                        this.elements.searchCurrency.value = '';
                        resultsContainer.innerHTML = '';
                        this.convertCurrency();
                    });
                    resultsContainer.appendChild(resultElement);
                });
            }

            setLoading(loading) {
                if (loading) {
                    document.body.classList.add('loading');
                    this.elements.convertButton.textContent = 'Convertendo...';
                } else {
                    document.body.classList.remove('loading');
                    this.elements.convertButton.textContent = 'Converter';
                }
            }

            showError(message) {
                this.elements.convertedAmount.textContent = 'Erro';
                this.elements.exchangeRate.textContent = message;
                this.elements.convertedAmount.style.color = '#dc3545';
                
                setTimeout(() => {
                    this.elements.convertedAmount.style.color = '#333';
                }, 3000);
            }
        }

        // Inicializar o aplicativo quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', () => {
            new CurrencyConverter();
        });
    </script>
</body>
</html>